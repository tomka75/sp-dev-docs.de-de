# <a name="create-and-use-access-tokens-in-provider-hosted-high-trust-sharepoint-add-ins"></a><span data-ttu-id="7c7ee-101">Erstellen und Verwenden von Zugriffs-Tokens in vom Anbieter gehosteten SharePoint-Add-Ins mit hoher Vertrauenswürdigkeit</span><span class="sxs-lookup"><span data-stu-id="7c7ee-101">Create and use access tokens in provider-hosted high-trust SharePoint Add-ins</span></span>
<span data-ttu-id="7c7ee-102">Erfahren Sie mehr über die Rolle von Zugriffstoken in SharePoint-Add-Ins mit hoher Vertrauensstufe und wie Ihr Code hiermit verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-102">Learn about the role of access tokens in high-trust SharePoint Add-ins and how your code works with them.</span></span>
 

 <span data-ttu-id="7c7ee-p101">**Hinweis** Der Name „Apps für SharePoint“ wird in „SharePoint-Add-Ins“ geändert. Während des Übergangszeitraums wird in der Dokumentation und der Benutzeroberfläche einiger SharePoint-Produkte und Visual Studio-Tools möglicherweise weiterhin der Begriff „Apps für SharePoint“ verwendet. Weitere Informationen finden Sie unter [Neuer Name für Office- und SharePoint-Apps](new-name-for-apps-for-sharepoint.md#bk_newname).</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p101">The name "apps for SharePoint" is changing to "SharePoint Add-ins". During the transition, the documentation and the UI of some SharePoint products and Visual Studio tools might still use the term "apps for SharePoint". For details, see [New name for apps for Office and SharePoint](new-name-for-apps-for-sharepoint.md#bk_newname).</span></span>
 


 <span data-ttu-id="7c7ee-p102">**WICHTIG**   **In diesem Artikel geht es nur um die Verwendung von Zugriffstokens im besonders vertrauenswürdigen Autorisierungssystem, und nicht um das ACS-System.** Informationen zur Verwendung von Sicherheitstokens im ACS-System finden Sie unter [Handhabung von Sicherheitstoken in vom Anbieter gehosteten Add-Ins für SharePoint mit niedriger Vertrauensebene](handle-security-tokens-in-provider-hosted-low-trust-sharepoint-add-ins.md).</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p102">**Important**   **This article is entirely about the use of access tokens in the high-trust authorization system, not the ACS system.** For information about the user of security tokens in the ACS system, see [Handle security tokens in provider-hosted low-trust SharePoint Add-ins](handle-security-tokens-in-provider-hosted-low-trust-sharepoint-add-ins.md).</span></span>
 


 <span data-ttu-id="7c7ee-p103">**SharePoint-Add-Ins, die das [besonders vertrauenswürdige Autorisierungssystem](creating-sharepoint-add-ins-that-use-high-trust-authorization.md) verwenden, um auf SharePoint zuzugreifen, müssen ein Zugriffstoken** (im [JSON Web Token](http://datatracker.ietf.org/doc/draft-ietf-oauth-json-web-token/)-Format) mit jeder CRUD-Anforderung (Erstellen, Lesen, Aktualisieren oder Löschen) an SharePoint übergeben. SharePoint validiert das Token und verarbeitet die Anforderung. In diesem Artikel finden Sie Informationen dazu, wie der Code das Zugriffstoken erstellt und übergibt.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p103"> spapppluralcap that use the high-trust authorization system to gain access to spnv have to pass an access token (in  JSON Web Token http://datatracker.ietf.org/doc/draft-ietf-oauth-json-web-token/  format) to spnv with each create, read, update, or delete (CRUD) request. spnv validates the token and serves the request. This article provides information about how your code creates and passes the access token.</span></span>
 

<span data-ttu-id="7c7ee-p104">Im besonders vertrauenswürdigen Autorisierungssystem erstellt **die Remotekomponente Ihres SharePoint-Add-Ins das Zugriffstoken**. Wenn die Remotekomponente verwalteten Code für ihren serverseitigen Code verwendet, wird der größte Teil der Codierungsarbeit für das Erstellen der Token in den Dateien „SharePointContext.cs“ (oder .vb) und „TokenHelper.cs“ (oder .vb) für Sie durchgeführt, die in den Office Developer Tools für Visual Studio enthalten sind. Da der Kunde für ein besonders vertrauenswürdiges SharePoint-Add-In über eine lokale SharePoint-Version verfügt, ist er wahrscheinlich nicht abgeneigt, ASP.NET, IIS und Windows Server als Hosting-Stapel für die Remotekomponente zu verwenden. Sie sollten die Verwendung dieses Stapels in Betracht ziehen, da die zwei generierten Dateien Ihnen viel Codierungs- und Testarbeit abnehmen. Wenn Sie für die Remotekomponente eine Nicht-.NET-Sprache verwenden müssen und sowohl die Remotekomponente als auch die SharePoint-Farm mit dem Internet verbunden sind, sollten Sie die Verwendung des [Autorisierungssystem mit niedriger Vertrauensebene](creating-sharepoint-add-ins-that-use-low-trust-authorization.md) anstelle des besonders vertrauenswürdigen Autorisierungssystems in Betracht ziehen. Im Microsoft Azure Access Control Service (ACS) erfolgt die gesamte Tokenkonstruktion über ACS, sodass Ihnen ebenfalls eine Menge Arbeit erspart wird. Im restlichen Teil des Artikels finden Sie hauptsächlich Anweisungen für Entwickler, die SharePoint-Add-Ins mit Nicht-.NET-Remotekomponenten erstellen und das besonders vertrauenswürdige Autorisierungssystem verwenden. Sie finden außerdem einige nützliche Informationen für das Debugging von .NET-basierten SharePoint-Add-Ins, die das besonders vertrauenswürdige System verwenden.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p104">SharePoint Add-ins that use the  high-trust authorization system to gain access to SharePoint have to pass an access token (in JSON Web Token format) to SharePoint with each create, read, update, or delete (CRUD) request. SharePoint validates the token and serves the request. This article provides information about how your code creates and passes the access token. In the high-trust authorization system, **the remote component of your SharePoint Add-in creates the access token**. If the remote component is using managed code for its server-side code, most of the coding work for creating the tokens is done for you in the SharePointContext.cs (or .vb) and TokenHelper.cs (or .vb) files that are included in Office Developer Tools for Visual Studio. Since the customer for a high-trust SharePoint Add-in has on-premise SharePoint, they are probably not averse to using ASP.NET, IIS, and Windows Sever as the hosting stack for the remote component. You should consider using this stack because the two generated files will save you a lot of coding and testing labor. If the remote component must use a non-.NET language, and both the remote component and the SharePoint farm are connected to the Internet, you should consider using [the low-trust authorization system](creating-sharepoint-add-ins-that-use-low-trust-authorization.md) instead of high-trust. In the Microsoft Azure Access Control Service (ACS) system, all the token construction is done by ACS, so you are also spared a lot of labor. The remainder of this article is mainly intended to provide guidance to developers creating SharePoint Add-ins with non-.NET remote components and using the high-trust authorization system. It can also provide some valuable information for debugging .NET-based SharePoint Add-ins that use the high-trust system.</span></span>
 

## <a name="understand-the-handling-of-access-tokens"></a><span data-ttu-id="7c7ee-119">Grundlegendes zur Verwendung von Zugriffstoken</span><span class="sxs-lookup"><span data-stu-id="7c7ee-119">Understand the handling of access tokens</span></span>
<span data-ttu-id="7c7ee-120"><a name="AccessTokens"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-120"></span></span>


 <span data-ttu-id="7c7ee-p105">**Hinweis** Denken Sie bei der Lektüre dieses Artikels, insbesondere in Bezug auf Aufgaben, die Ihr Code durchführen muss, daran, dass bei der Verwendung von verwaltetem Code die Microsoft Office Developer Tools für Visual Studio jedem SharePoint-Add-In-Projekt zwei generierte Codedateien, SharePointContext.cs (oder .vb) und TokenHelper.cs (oder .vb) hinzufügen, die den größten Teil der Arbeit für Sie übernehmen. Der Tokenverarbeitungscode Ihrer Anwendung besteht für gewöhnlich aus nur wenigen Aufrufen an die Klassen in diesen Dateien. Die ausführlichen Informationen in diesem Thema helfen Entwicklern, die keinen verwalteten Code verwenden (bei der Behandlung von Problemen mit Tokens). Links zu OAuth-Bibliotheken für viele Sprachen und Plattformen finden Sie unter [OAuth 2.0](http://oauth.net/2/). Blättern Sie zu **Clientbibliotheken**. Zusätzliche Informationen finden Sie, wenn Sie auf [github](https://github.com/) nach „OAuth 2“ und „JSON web token“ suchen (ohne Anführungszeichen).</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p105">**Note** Keep in mind when reading this article, particularly about tasks that your code must carry out, that if you are using managed code, the Microsoft Office Developer Tools for Visual Studio add to every SharePoint Add-in project two generated code files, SharePointContext.cs (or .vb) and TokenHelper.cs (or .vb) that do most of these tasks for you. Your application's token handling code usually consists of just a few calls to the classes in these files. The details in this topic are to help developers who are not using managed code (and to help those who are with troubleshooting problems with tokens).</span></span>
 

<span data-ttu-id="7c7ee-126">Die folgenden wichtigen **Dinge muss Ihr Code übernehmen**:</span><span class="sxs-lookup"><span data-stu-id="7c7ee-126">The main **things that your code needs to** do are:</span></span>
 

 

1.  <span data-ttu-id="7c7ee-p106">**Erstellen eines Zugriffstokens.** Die Teilaufgaben für das Erstellen dieses Tokens sind unterschiedlich, je nachdem, ob die RemotewebanwendungNur-Add-In-Aufrufe an SharePoint, Benutzer-und-Add-In-Aufrufe oder beides durchführt. (Informationen zu den zwei Arten von Aufrufen finden Sie unter  [Add-In-Autorisierungsrichtlinientypen in SharePoint 2013](add-in-authorization-policy-types-in-sharepoint-2013.md).)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p106">**Create an access token.** The subtasks for creating this token vary depending on whether the remote web application makesadd-in-only calls to SharePoint,user+add-in calls, or both. (For information about the two kinds of calls, see [Add-in authorization policy types in SharePoint 2013](add-in-authorization-policy-types-in-sharepoint-2013.md).)</span></span> 
    
    <span data-ttu-id="7c7ee-130">Wenn das Add-In Benutzer-und-Add-In-Aufrufe durchführt, umfasst das Erstellen des Zugriffstokens die folgenden Teilaufgaben:</span><span class="sxs-lookup"><span data-stu-id="7c7ee-130">If the add-in makes user+add-in calls, then creating the access token includes the following subtasks:</span></span>
    
      1. <span data-ttu-id="7c7ee-p107">Erstellen eines Actor-Tokens, das das SharePoint-Add-In identifiziert und SharePoint mitteilt, die Benutzerauthentifizierung und -autorisierung an das Add-In zu delegieren und es in der Base64-Codierung zu codieren. Ausführliche Informationen zu den Ansprüchen und der Struktur des Actor-Tokens finden Sie in Tabelle 2 unten. Details zum Codieren und Signieren des Tokens finden Sie unter  [Codieren und Signieren von Token](#EncodingTokens) weiter unten.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p107">Create an actor token that identifies the SharePoint Add-in and tells SharePoint to delegate user authentication and authorization to your add-in, and encode it in base 64 encoding. Details about the claims and structure of the actor token are in table 2 below. Details about encoding and signing the token are in [Encoding and signing tokens](#EncodingTokens) below.</span></span>
    
 
  2. <span data-ttu-id="7c7ee-134">Signieren Sie das Actor-Token mit Anmeldeinformationen aus einem x509-Zertifikat, das ein SharePoint-Farmadministrator so konfiguriert hat, dass SharePoint ihm vertraut.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-134">Sign the actor token with credentials from an x509 certificate that a SharePoint farm administrator has configured SharePoint to trust.</span></span>
    
 
  3. <span data-ttu-id="7c7ee-135">Schließen Sie das Actor-Token in das Zugriffstoken ein.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-135">Include the actor token in the access token.</span></span>
    
 
  4. <span data-ttu-id="7c7ee-p108">Fügen Sie dem Zugriffstoken weitere erforderliche Ansprüche hinzu. Ausführliche Informationen zu den Ansprüchen und der Struktur des Tokens finden Sie in Tabelle 1 unten.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p108">Add other required claims to the access token. Details about the claims and structure of the token are in table 1 below.</span></span>
    
 
  5. <span data-ttu-id="7c7ee-p109">Codieren Sie das Zugriffstoken mit Base64. Details zum Codieren und Signieren des Tokens finden Sie unter  [Codieren und Signieren von Token](#EncodingTokens) weiter unten.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p109">Encode the access token with base 64. Details about encoding and signing the token are in  [Encoding and signing tokens](#EncodingTokens) below.</span></span>
    
 

    <span data-ttu-id="7c7ee-p110">Wenn das Add-In Nur-Add-In-Aufrufe durchführt, muss Ihr Code nur die ersten zwei dieser Teilaufgaben ausführen. Das Actor-Token dient als Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p110">If the add-in makes add-in-only calls, then your code only needs to do the first two of these subtasks. The actor token serves as the access token.</span></span>
    
    <span data-ttu-id="7c7ee-p111">Wenn das Add-In einige Benutzer-und-Add-In-Aufrufe und einige Nur-Add-In-Aufrufe durchführt, muss sie ein einfaches Actor-Token für die Nur-Add-In-Aufrufe und das größere, verschachtelte Zugriffstoken für die Benutzer-und-App-Aufrufe erstellen. Es können nicht dieselben Zugriffstoken für beide Arten von Aufrufen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p111">If the add-in makes some user+add-in calls and some add-in-only calls, it must create a simple actor token for the add-in-only calls and the larger, nested access token for the user+add-in calls. The same access token cannot be used for both.</span></span>
    
 
2.  <span data-ttu-id="7c7ee-p112">**Schließen Sie das Zugriffstoken in jede HTTP-Anforderung an SharePoint ein.** Das Token wird als ein **Authorization**-Header an die Anforderung angehängt. Der Wert des Headers ist das Wort "Bearer", gefolgt von einem Leerzeichen, gefolgt von dem Base64-codierten Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p112">**Include the access token in every HTTP request to SharePoint.** The token is added as an **Authorization** header to the request. The value of the header is the word "Bearer", followed by a space, followed by the base 64-encoded access token.</span></span>
    
 
3. <span data-ttu-id="7c7ee-147">Optional können Sie **das Zugriffstoken zwischenspeichern**, damit es in nachfolgenden Anforderungen erneut verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-147">Optionally, **cache the access token** for reuse on subsequent requests.</span></span>
    
 
<span data-ttu-id="7c7ee-p113">Diese Aufgaben müssen mit serverseitigem Code durchgeführt werden. Wenn Sie verwalteten Code verwenden, befindet sich Beispielcode für einige dieser Aufgaben in den Dateien SharePointContext.cs (oder .vb) und TokenHelper.cs (oder .vb), die von den Microsoft Office-Entwicklertools für Visual Studio generiert werden.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p113">These tasks must be done with server-side code. If you are using managed code, sample code for some of these tasks is in the SharePointContext.cs (or .vb) and TokenHelper.cs (or .vb) files that the Microsoft Office Developer Tools for Visual Studio generate.</span></span>
 

 

### <a name="cache-the-access-token"></a><span data-ttu-id="7c7ee-150">Zwischenspeichern des Zugriffstokens</span><span class="sxs-lookup"><span data-stu-id="7c7ee-150">Cache the access token</span></span>
<span data-ttu-id="7c7ee-151"><a name="CacheAccessToken"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-151"></span></span>

<span data-ttu-id="7c7ee-p114">Nach der Erstellung eines Tokens kann dieses in späteren Aufrufen an SharePoint erneut verwendet werden, bis es abläuft. Je nach Architektur der Remotekomponente und der Hosting-Plattform gibt es verschiedene **Wege zum Zwischenspeichern des Zugriffstokens** auf dem Server.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p114">After a token is created, it can be reused in later calls to SharePoint until it expires. Depending on the remote component's architecture and hosting platform, there are several **ways to cache the access token** on the server.</span></span>
 

 

- <span data-ttu-id="7c7ee-154">Im Sitzungszustand</span><span class="sxs-lookup"><span data-stu-id="7c7ee-154">In session state</span></span>
    
 
- <span data-ttu-id="7c7ee-155">Im Anwendungsstatus</span><span class="sxs-lookup"><span data-stu-id="7c7ee-155">In application state</span></span>
    
 
- <span data-ttu-id="7c7ee-156">Im  [Windows Server AppFabric-Cachedienst](http://msdn.microsoft.com/library/8aef3f5d-2a77-46d9-b951-0768fedd31a1%28Office.15%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="7c7ee-156">In  [Windows Server AppFabric Caching](http://msdn.microsoft.com/library/8aef3f5d-2a77-46d9-b951-0768fedd31a1%28Office.15%29.aspx).</span></span>
    
 
- <span data-ttu-id="7c7ee-157">In einer Datenbank</span><span class="sxs-lookup"><span data-stu-id="7c7ee-157">In a database</span></span>
    
 
- <span data-ttu-id="7c7ee-158">In einem [memcached](http://www.memcached.org/)-System</span><span class="sxs-lookup"><span data-stu-id="7c7ee-158">In a  [memcached](http://www.memcached.org/) system</span></span>
    
 
<span data-ttu-id="7c7ee-p115">Wenn der Cachespeicher, beispielsweise der Anwendungscache, von verschiedenen Benutzersitzungen gemeinsam verwendet wird, müssen Sie sicherstellen, dass Sie einen Cacheschlüssel verwenden, der für die Sitzung eindeutig ist. Wenn der Cache von mehreren Anwendungen gemeinsam verwendet wird, muss Ihr Code zudem auch für diese Variable **den Cacheschlüssel relativieren**. Es ist außerdem möglich, dass das Add-In auf verschiedene SharePoint-Farmen zugreift. Sie benötigen unterschiedliche Token für jede davon, müssten in diesem Szenario also den Cacheschlüssel für die Farm relativieren. Insgesamt benötigen Sie möglicherweise Cacheschlüssel, die auf einem oder mehreren Elementen aus Benutzer-ID, Anwendungs-ID und SharePoint-Domäne oder -Bereich basieren. Ziehen Sie in Betracht, ein ähnliches Cacheschlüsselsystem wie das von SharePoint-Add-Ins zu benutzen, die das Autorisierungssystem mit niedriger Vertrauensebene verwenden. Ausführliche Informationen finden Sie unter [Überblick über den Cacheschlüssel](handle-security-tokens-in-provider-hosted-low-trust-sharepoint-add-ins.md#CacheKey). Im Wesentlichen würden Sie eine oder mehrere dieser drei IDs verknüpfen (und optional einen Hash mit einer kürzere Zeichenfolge daraus erstellen) und dann als Cacheschlüssel verwenden.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p115">If the cache storage is shared by different user sessions, such as the application cache, then be sure to use a cache key that is unique to the session. If the cache is shared by multiple applications, your code must also **relativize the cache key** for that variable as well. It is also possible that your add-in accesses different SharePoint farms. You will need distinct access tokens for each of them, so in that scenario your cache key would need to relativize for the farm. Altogether you may need cache keys that are based on one or more of user ID, application ID, and SharePoint domain or realm. Consider using a cache key system similar to the one used by SharePoint Add-ins that use the low-trust authorization system. For details, see [Understand the cache key](handle-security-tokens-in-provider-hosted-low-trust-sharepoint-add-ins.md#CacheKey). Essentially, you would concatenate one or more of these three IDs (and optionally hash the result into a shorter string) to serve as a cache key.</span></span> 
 

 

### <a name="handle-expired-access-tokens"></a><span data-ttu-id="7c7ee-167">Umgang mit abgelaufenen Zugriffstoken</span><span class="sxs-lookup"><span data-stu-id="7c7ee-167">Handle expired access tokens</span></span>
<span data-ttu-id="7c7ee-168"><a name="CacheAccessToken"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-168"></span></span>

 <span data-ttu-id="7c7ee-p116">**Das Zugriffstoken hat einen Ablaufzeitpunkt**, den Ihr Code auf einen beliebigen Wert festlegen kann. Wenn Ihr Add-In ein neues Zugriffstoken für jede Anforderung erstellt, muss jedes Token nur lange genug gültig sein, um von SharePoint validiert zu werden, das heißt, nicht mehr als einige Sekunden, solange das LAN des Kunden nicht für gewöhnlich überlastet ist. Sie könnten den Ablaufzeitpunkt auch auf mehrere Jahre in der Zukunft festlegen, aber selbst im „komplett lokalen" Szenario, für das besonders vertrauenswürdige Add-Ins ausgelegt sind, besteht die Gefahr, dass Zugriffstoken gestohlen werden. Deshalb sollten Sie den Ablaufzeitpunkt nicht auf mehr als einige Stunden festlegen. (Wenn Sie mit verwaltetem Code arbeiten, legt der Beispielcode für die Tokenerstellung in der Datei TokenHelper.cs [oder .vb] die Ablauffrist auf 12 Stunden fest.)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p116">**The access token has an expiration time** which your code can set to any value you want. If your add-in constructs a new access token for every request, then each token only has to live long enough to be validated by SharePoint, no more than a few seconds unless the customer's LAN is usually clogged. You could set the expiration to years in the future, but even in the "all on-premise" scenario for which high-trust add-ins are designed, there is some danger of access tokens being stolen. So you should consider setting the expiration to no more than a few hours. (If you are working with managed code, the sample token-creation code in the TokenHelper.cs [or .vb] file sets the expiration to 12 hours.)</span></span>
 

 
<span data-ttu-id="7c7ee-p117">Wenn die Sitzung eines Benutzers mit dem SharePoint-Add-In länger als die Lebensspanne des zwischengespeicherten Zugriffstokens dauert, führt die erste Anforderung an SharePoint nach Ablauf des Tokens zu einem **401 Unauthorized**-Fehler. Ihr Code muss diese Antwort verarbeiten. Alternativ kann er den Ablaufzeitpunkt des Zugriffstokens testen, bevor es verwendet wird. **Ihr Code sollte auf ein abgelaufenes Zugriffstoken mit der Erstellung eines neuen Zugriffstokens reagieren** und die fehlgeschlagene Anforderung wiederholen.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p117">If a user's session with your SharePoint Add-in lasts longer than the lifespan of the cached access token, then the first request to SharePoint after the expiration of the token will result in a **401 Unauthorized** error. Your code has to handle this response. Alternatively, it can test the expiration time of the access token before it is used. **Your code should respond to an expired access token by creating a new access token** and repeating the request that failed.</span></span>
 

 

## <a name="understand-the-structure-of-access-tokens"></a><span data-ttu-id="7c7ee-178">Grundlegendes zur Struktur von Zugriffstoken</span><span class="sxs-lookup"><span data-stu-id="7c7ee-178">Understand the structure of access tokens</span></span>
<span data-ttu-id="7c7ee-179"><a name="Structure"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-179"></span></span>

<span data-ttu-id="7c7ee-p118">Im Folgenden finden Sie ein **Beispiel für ein Zugriffstoken, das von einem besonders vertrauenswürdigen SharePoint-Add-In** erstellt wurde. Genauer gesagt wurde dieses Token von dem Beispielcode in der Datei TokenHelper.cs (oder .vb) erstellt, die Teil der SharePoint-Add-In-Projektvorlage ist, die von den Office Developer Tools für Visual Studio in Visual Studio 2013 Update 2 erstellt wurde. Das Token wurde codiert und zur besseren Lesbarkeit wurden Leerzeichen eingefügt. Die im besonders vertrauenswürdigen System verwendeten Token sind konform mit dem [[MS-SPS2SAUTH]: OAuth 2.0 Authentication Protocol: SharePoint Profile](http://msdn.microsoft.com/library/05f9759b-0fa4-45ff-bd4b-0d7d254e7010.aspx), das auch als Server-zu-Server- oder S2S-Protokoll bezeichnet wird. Diese Informationen werden bereitgestellt, um Entwickler, die verwalteten Code verwenden, beim Debugging von besonders vertrauenswürdigen SharePoint-Add-Ins zu unterstützen, und Entwicklern, die andere Sprachen verwenden, Anleitungen zum Konstruieren der Token zur Verfügung zu stellen.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p118">The following is an **example of an access token generated by a high-trust SharePoint Add-in**; specifically, this token was generated by the sample code in the TokenHelper.cs (or .vb) file that is part of the SharePoint Add-in project template created by the Office Developer Tools for Visual Studio in Visual Studio 2013 Update 2. The token has been decoded and white space has been added for readability. The access tokens used in the high-trust system are compliant with the [[MS-SPS2SAUTH]: OAuth 2.0 Authentication Protocol: SharePoint Profile](http://msdn.microsoft.com/library/05f9759b-0fa4-45ff-bd4b-0d7d254e7010.aspx), which is also called the server-to-server or S2S protocol. This information is provided to help developers using managed code debug high-trust SharePoint Add-ins, and to provide some guidance to developers using other languages about how to construct the tokens.</span></span>
 

 
 <span data-ttu-id="7c7ee-p119">**Dieses Zugriffstoken wird generiert, wenn das Add-In einen Aufruf an SharePoint unter Verwendung der  [Benutzer-und-Add-In-Richtlinie](add-in-authorization-policy-types-in-sharepoint-2013.md) durchführt.** Wenn das Add-In die [Nur-Add-In-Richtlinie](add-in-authorization-policy-types-in-sharepoint-2013.md) verwendet und einen Nur-Add-In-Aufruf an SharePoint durchführt, wird das Actor-Token (das ein untergeordnetes Token innerhalb eines Benutzer-und-Add-In-Zugriffstokens ist und weiter unten beschrieben wird) zum Zugriffstoken (und es gibt kein übergeordnetes Token).</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p119">**This access token is generated if the add-in is making a call to SharePoint using the  [user+add-in policy](add-in-authorization-policy-types-in-sharepoint-2013.md).** If the add-in is using the [add-in-only policy](add-in-authorization-policy-types-in-sharepoint-2013.md) and it makes an add-in-only call to SharePoint, then the actor token (which is a child token within the user+add-in access token and is described below), becomes the access token (and there is no parent token).</span></span>
 

 

 <span data-ttu-id="7c7ee-p120">**Hinweis** Beachten Sie, dass sich die Zugriffstoken mit hoher Vertrauensstufe, die von Ihrem Code erstellt werden, sich von denen unterscheiden, die Azure ACS erstellt, wenn das Autorisierungssystem mit niedriger Vertrauensstufe verwendet wird: Der **alg**-Anspruch im Header lautet „none“, da das Zugriffstoken in einem Benutzer-und-Add-In-Aufruf von eine Add-In mit hoher Vertrauensstufe nicht signiert ist. Die URL des Add-Ins im **aud**-Wert in diesem Beispiel befindet sich auf einem lokalen Server, was für ein System mit hoher Vertrauensstufe normal ist. Es gibt keinen **identityprovider**-Ansprucht, jedoch einen **nii** (name identity issuer) mit den gleichen Arten von Werten wie für die Zugriffstoken des **identityprovider**-Anspruchs, der im Autorisierungssystem mit niedriger Vertrauensstufe verwendet wird. (Informationen zu diesem Wert, wenn es sich um einen SAML-baiserten Identitätsanbieter handelt, finden Sie im Blog-Post von Steve Peschka [Sicherheit von SharePoint-Add-Ins - Teil 8](http://blogs.technet.com/b/speschka/archive/2013/08/01/security-in-sharepoint-apps-part-8.aspx) und unter [Verwenden von SharePoint-Add-Ins mit SAML- und FBA-Websites in SharePoint 2013](http://blogs.technet.com/b/speschka/archive/2012/12/07/using-sharepoint-apps-with-saml-and-fba-sites-in-sharepoint-2013.aspx). Es gibt keinen **actor**-Anspruch, jedoch einen **actortoken**-Anspruch, der ein Base64-kodiertes inneres Token mit einer Lebensdauer von 12 Stunden enthält.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p120">**Note**   Note that the high-trust access tokens that your code creates are different from those created by Azure ACS when the low-trust authorization system is being used: The **alg** claim in the header is "none" because the access token in a user+add-in call from a high-trust add-in is not signed. The add-in URL in the **aud** value in this example is an on premise server, which is normal for the high-trust system. There is no **identityprovider** claim, but there is a **nii** (name identity issuer) with the same kind of values as the **identityprovider** claim access tokens used in the low-trust authorization system. (For information about this value when the identity provider is SAML-based, see Steve Peschka's blog posts [Security in SharePoint Add-ins - Part 8](http://blogs.technet.com/b/speschka/archive/2013/08/01/security-in-sharepoint-apps-part-8.aspx) and [Using SharePoint Add-ins with SAML and FBA Sites in SharePoint 2013](http://blogs.technet.com/b/speschka/archive/2012/12/07/using-sharepoint-apps-with-saml-and-fba-sites-in-sharepoint-2013.aspx).  There is no **actor** claim, but there is an **actortoken** claim that contains a base 64 encoded inner token with a 12 hour lifespan.</span></span>
 

<span data-ttu-id="7c7ee-p121">Der Header hat zwei Eigenschaften. „typ" ist der Tokentyp. Der Code in der Remotewebanwendung sollte diesen Wert immer auf „JWT" festlegen. „alg" ist der Algorithmus, der für das Signieren des Tokens verwendet wird. Da das äußere Token in einem Benutzer-und-Add-In-Aufruf von einem besonders vertrauenswürdigen Add-In nicht signiert wird, legen Sie diesen Wert auf „none" fest. Informationen zu den Werten im Hauptteil des besonders vertrauenswürdigen Zugriffstokens finden Sie in Tabelle 1.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p121">The header has two properties. The "typ" is the type of token. Code in the remote web application should always set this value to "JWT". The "alg" is the algorithm used to sign the token. Since the outer token in a user+add-in call from a high-trust add-in is not signed, set this value to "none". See table 1 for information about the values in the body part of the high-trust access token.</span></span>
 

 



```
{"typ":"JWT", "alg":"none"} 
.
{
 "aud":"00000003-0000-0ff1-ce00-000000000000/MarketingServer@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2",
 "iss":"c3ab8885-458f-4864-8804-1608145e2ac4@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2",
 "nbf":"1403212820",
 "exp":"1403256020",
 "nameid":"s-1-5-21-2127521184-1604012920-1887927527-2963467",
 "nii":"urn:office:idp:activedirectory",
 "actortoken":"6sMZhbw … [remainder of long base 64 string omitted] … "
}

```

<span data-ttu-id="7c7ee-p122">In der folgenden Tabelle finden Sie einige Anweisung dazu, welche **Eigenschaften Ihr Code in das Zugriffstoken einschließen sollte und welche Werte für diese Eigenschaften festgelegt werden sollten**. Wenn Sie verwalteten Code verwenden, erstellen die Dateien SharePointContext.cs (oder .vb) und TokenHelper.cs (oder .vb) die Token für Sie. Nehmen wir beispielsweise an, Ihr Code führt einen einzigen Aufruf an die **SharePointContext.CreateUserClientContextForSPHost**-Methode durch. Diese wiederum ruft Methoden in der **TokenHelper**-Klasse auf, die das Zugriffstoken konstruieren, das dann in jeden Aufruf an SharePoint durch das SharePoint-Clientkontextobjekt eingefügt wird, das von **SharePointContext.CreateUserClientContextForSPHost** zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p122">The following table provides some guidance for what **properties your code should include in the access token and what values to set for them**. If you are using managed code, the SharePointContext.cs (or .vb) and TokenHelper.cs (or .vb) files create the tokens for you. For example, you code makes a single call to the **SharePointContext.CreateUserClientContextForSPHost** method. It, in turn, calls methods in the **TokenHelper** class that construct the access token which is then included in every call made to SharePoint by the SharePoint client context object that is returned by **SharePointContext.CreateUserClientContextForSPHost**.</span></span>
 

 

<span data-ttu-id="7c7ee-201">**Tabelle 1: Von Apps ausgegebene Zugriffstokenansprüche**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-201">**Table 1: App-issued access token claims**</span></span>


|<span data-ttu-id="7c7ee-202">**Anspruch**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-202">**Claim**</span></span>|<span data-ttu-id="7c7ee-203">**Beschreibung**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-203">**Description**</span></span>|<span data-ttu-id="7c7ee-204">**Entsprechender Wert im Beispiel-Zugriffstoken**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-204">**Corresponding value in the sample access token**</span></span>|
|:-----|:-----|:-----|
| `aud`|<span data-ttu-id="7c7ee-p123">Abkürzung für „audience“ (Zielgruppe), was den Prinzipal bezeichnet, für den das Token vorgesehen ist. Das Format lautet _Audience-Prinzipal-ID_/ _vollqualifizierte SharePoint-Domäne_@ _SharePoint-Bereich_. Der Audience-Prinzipal für ein SharePoint-Add-In ist immer 00000003-0000-0ff1-ce00-000000000000. Da SharePoint-Add-Ins mit hoher Vertrauensstufe normalerweise in einem rein lokalen Szenario verwendet werden, ist der vollqualfizierter Name der SharePoint-Domäne häufig nur ein Servername. Der _SharePoint-Bereich_ ist die GUID der lokalen SharePoint-Farm, auf die mit dem Zugriffstoken zugegriffen wird (bzw. die GUID des Mandanten, wenn die Farm zur Verwendung von Mandanten konfiguriert wurde). Sie können den SharePoint-Bereich ermitteln, indem Sie das PowerShell-Cmdlet **Get-SPAuthenticationRealm** für den SharePoint-Server ausführen. Verwenden Sie ihn dann direkt im Code, oder speichern Sie ihn in einer Konfigurationsdatei, in der der Code ihn lesen kann, wie z. B. im Abschnitt „app.Settings“ einer web.config-Datei. Alternativ kann der Code den SharePoint-Bereich dynamisch erkennen, indem er eine Authentifizierungsaufforderung an SharePoint sendet. Ein Beispiel dazu, wie dies in verwaltetem Code erfolgt, finden Sie in der `GetRealmFromTargetUrl`-Methode in der Datei TokenHelper.cs (oder .vb).</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p123">Short for "audience", meaning the principal for which the token is intended. The format is  _audience principal ID_/ _fully qualified SharePoint domain_@ _SharePoint realm_.The audience principal for a SharePoint Add-in is always 00000003-0000-0ff1-ce00-000000000000.Since high-trust SharePoint Add-ins are normally used in an entirely on-premise scenario, the fully qualified SharePoint domain name is often just a server name.The  _SharePoint realm_ is the GUID of the on-premise SharePoint farm that the access token is used to access, (or the GUID of the tenancy, if the farm has been configured for tenancies).Find the SharePoint realm by running the PowerShell  **Get-SPAuthenticationRealm** cmdlet on the SharePoint server. Then use it directly in your code or store it in a configuration file where your code can read it, such as the app.Settings section of a web.config file. Alternatively, your code can dynamically discover the SharePoint realm at runtime by sending an authentication challenge to SharePoint. See the `GetRealmFromTargetUrl` method in the TokenHelper.cs (or .vb) file for an example of how this is done in managed code.</span></span>|<span data-ttu-id="7c7ee-210">00000003-0000-0ff1-ce00-000000000000/MarketingSharePointServer@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span><span class="sxs-lookup"><span data-stu-id="7c7ee-210">00000003-0000-0ff1-ce00-000000000000/MarketingSharePointServer@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span></span>|
| `iss`|<span data-ttu-id="7c7ee-p124">Abkürzung für „issuer“ (Aussteller). Dies stellt den Prinzipal dar, der das Token erstellt hat. Das Format ist _Aussteller-GUID_@ _SharePoint-Bereich-GUID_. Im System mit hoher Vertrauensstufe ist das Add-In selbst der Aussteller, sodass die Client-ID des SharePoint-Add-Ins in der Regel als Aussteller-GUID verwendet wird. *Alle Buchstaben in der Aussteller-ID müssen klein geschrieben werden.*</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p124">Short for "issuer". It represents the principal that created the token. The format is  _Issuer GUID_@ _SharePoint realm GUID_.In the high-trust system, the add-in itself is the issuer, so the client ID of the SharePoint Add-in is normally used for the issuer GUID.  *All letters in the issuer ID must be lower case.*</span></span> |<span data-ttu-id="7c7ee-215">c3ab8885-458f-4864-8804-1608145e2ac4@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span><span class="sxs-lookup"><span data-stu-id="7c7ee-215">c3ab8885-458f-4864-8804-1608145e2ac4@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span></span>|
| `nbf`|<span data-ttu-id="7c7ee-p125">Abkürzung für "not before" (nicht vor). Sie steht für den Zeitpunkt in Sekunden ab dem 1. Januar 1970 um Mitternacht, ab dem der Token  *beginnt*  , gültig zu werden. Ihr Code sollte diesen Wert auf den Moment festlegen, in dem das Token erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p125">Short for "not before". It represents the time at which the token  *starts*  being valid, in seconds since midnight, January 1, 1970. Your code should set this to the moment the token is created.</span></span>|<span data-ttu-id="7c7ee-219">1403212820</span><span class="sxs-lookup"><span data-stu-id="7c7ee-219">1403212820</span></span>|
| `exp`|<span data-ttu-id="7c7ee-p126">Abkürzung für "expiration". Sie steht für den Zeitpunkt, an dem das Token abläuft, in Sekunden nach dem 1. Januar 1970 um Mitternacht.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p126">Short for "expiration". It represents the time the token expires, in seconds since midnight, January 1, 1970.</span></span>|<span data-ttu-id="7c7ee-222">1403256020</span><span class="sxs-lookup"><span data-stu-id="7c7ee-222">1403256020</span></span>|
| `nameid`|<span data-ttu-id="7c7ee-p127">Ein eindeutiger Bezeichner für den Benutzer, für den das Token ausgestellt wurde. Das Format ist je nach Identitätsanbieter unterschiedlich. In diesem Beispiel ist der Anbieter Active Directory.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p127">A unique identifier for the user for whom the token is issued. The format varies depending on the identity provider. In this example, the provider is Active Directory.</span></span>|<span data-ttu-id="7c7ee-226">s-1-5-21-2127521184-1604012920-1887927527-2963467</span><span class="sxs-lookup"><span data-stu-id="7c7ee-226">s-1-5-21-2127521184-1604012920-1887927527-2963467</span></span>|
| `nii`|<span data-ttu-id="7c7ee-p128">Abkürzung für „name identifier issuer“ (Namensbezeichner des Ausstellers). Der eindeutige Name des Identitätsanbieters, wie er bei der IANA (Internet Assigned Numbers Authority) registriert its. Bei einem SharePoint-Add-In mit hoher Vertrauensstufe ist dies in der Regel ein lokaler Identitätsanbieter wie Active Directory in diesem Beispiel.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p128">Short for "name identifier issuer." The unique name of the identity provider as registered with the Internet Assigned Numbers Authority (IANA).For a high-trust SharePoint Add-in, it is typically be an on-premise identity provider, such as Active Directory as in this example.</span></span>|<span data-ttu-id="7c7ee-229">urn:office:idp:activedirectory</span><span class="sxs-lookup"><span data-stu-id="7c7ee-229">urn:office:idp:activedirectory</span></span>|
| `actortoken`|<span data-ttu-id="7c7ee-230">Ein Base64-codiertes JWT-Token, das das SharePoint-Add-In identifiziert und SharePoint mitteilt, dem Add-In zu vertrauen, unabhängig davon, welcher Benutzer das Add-In ausführt.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-230">A base 64-encoded JWT token that identifies the SharePoint Add-in and tells SharePoint to trust the add-in regardless of what user is running the add-in.</span></span>|<span data-ttu-id="7c7ee-231">Siehe unten.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-231">See below.</span></span>|
 <span data-ttu-id="7c7ee-p129">**Im Folgenden ist das decodierte **actortoken** gezeigt.** Das kleine JavaScript Object Notation (JSON)-Headerobjekt im oberen Bereich enthält Metadaten zum Token, einschließlich Tokentyp und Algorithmus, mit dem es signiert wird. Die Eigenschaft **x5t** des Headers ist ein Digest, der aus dem Fingerabdruck des x.509-Zertifikats erstellt wird, das der offizielle Aussteller des Tokens ist. Ihr Code geht zum Konstruieren dieses Werts wie folgt vor:</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p129">**The following shows the decoded **actortoken**.** The small JavaScript Object Notation (JSON) header object at the top contains metadata about the token, including the type of token and the algorithm that is used to sign it. The **x5t** property of the header is a digest made from the thumbprint of the x.509 certificate that is officially the issuer of the token. To construct this value, your code does the following:</span></span>
 

 

1. <span data-ttu-id="7c7ee-p130">Abrufen der Bytearrayversion (nicht der Zeichenfolge) des Fingerabdrucks des Zertifikats. Dies ist ein SHA-1-Digest des Zertifikats. (In verwaltetem Code kann dies mit der Methode  [GetCertHash()](http://msdn2.microsoft.com/EN-US/library/4f9acc3f) durchgeführt werden. Sie benötigen etwas Äquivalentes in der Sprache, die Sie verwenden.)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p130">Obtain the byte array (not string) version of the thumbprint of the certificate. This is a SHA-1 digest of the certificate. (In managed code, this can be done with the  [GetCertHash()](http://msdn2.microsoft.com/EN-US/library/4f9acc3f) method. You will need something equivalent in the language you are using.)</span></span>
    
 
2. <span data-ttu-id="7c7ee-240">Codiertes Bytearray mit Base64-URL-Codierung.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-240">Encode the byte array with Base 64 URL encoding.</span></span>
    
 
3. <span data-ttu-id="7c7ee-241">Legen Sie den Wert der Eigenschaft **x5t** auf den codierten Digest fest.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-241">Set the value of the **x5t** property to the encoded digest.</span></span>
    
 
<span data-ttu-id="7c7ee-242">Tabelle 2 beschreibt die Ansprüche, die der Code im Hauptteil des Tokens einschließen muss, sowie die dafür festzulegenden Werte.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-242">Table 2 describes the claims your code must include in the body of the token and the values to set for them.</span></span>
 

 



```
{"typ":"JWT","alg":"RS256","x5t":"7MjK99QvkVdwz6UrKldx8AG7ydM"}
.
{
 "aud":"00000003-0000-0ff1-ce00-000000000000/MarketingServer@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2",
 "iss":"11111111-1111-1111-1111-111111111111@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2",
 "nbf":"1403212820",
 "exp":"1403256020",
 "nameid":"c3ab8885-458f-4864-8804-1608145e2ac4@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2",
 "trustedfordelegation":"true"
}

```


 <span data-ttu-id="7c7ee-p131">**Hinweis** Wenn das besonders vertrauenswürdige Add-In die [Nur-Add-In-Richtlinie](add-in-authorization-policy-types-in-sharepoint-2013.md) verwendet und einen Nur-Add-In-Aufruf an SharePoint durchführt, ist das hier gezeigte Token tatsächlich das Zugriffstoken. Es gibt kein äußeres Token. Darüber hinaus gibt es keinen **trustedfordelegation**-Anspruch, da die Berechtigungen des Benutzers für einen Nur-Add-In-Aufruf irrelevant sind.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p131">**Note** If the high-trust add-in is using the  [add-in-only policy](add-in-authorization-policy-types-in-sharepoint-2013.md) and it makes an add-in-only call to SharePoint, then the token shown here is actually the access token. There is no outer token. Moreover, there is no **trustedfordelegation** claim, since the user's permissions are irrelevant for an add-in-only call.</span></span>
 


<span data-ttu-id="7c7ee-246">**Tabelle 2: ActorToken-Ansprüche mit ausgestelltem Zertifikat**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-246">**Table 2: Certificate-issued actortoken claims**</span></span>


|<span data-ttu-id="7c7ee-247">**Anspruch**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-247">**Claim**</span></span>|<span data-ttu-id="7c7ee-248">**Beschreibung**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-248">**Description**</span></span>|<span data-ttu-id="7c7ee-249">**Entsprechender Wert im Beispielzugriffstoken**</span><span class="sxs-lookup"><span data-stu-id="7c7ee-249">**Corresponding value in the sample access token**</span></span>|
|:-----|:-----|:-----|
| `aud`|<span data-ttu-id="7c7ee-250">Wie im übergeordneten Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-250">Same as in the parent access token.</span></span>|<span data-ttu-id="7c7ee-251">00000003-0000-0ff1-ce00-000000000000/MarketingSharePointServer@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span><span class="sxs-lookup"><span data-stu-id="7c7ee-251">00000003-0000-0ff1-ce00-000000000000/MarketingSharePointServer@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span></span>|
| `iss`|<span data-ttu-id="7c7ee-p132">Gleiche Bedeutung wie im übergeordneten Zugriffstoken, wobei die Aussteller-GUID jedoch nicht die Client-ID der Webanwendung ist, sonder die GUID des Zertifikats. Obwohl der Code in der Anwendung das Actortoken konstruiert, wird das Zertifikat als Aussteller des Actortokens angesehen. Beachten Sie, dass die Aussteller-GUID in diesem Beispiel eine einfach zu merkende GUID-Zeichenfolge ist, die der Farmadministrator bei der Registrierung des x.509-Zertifikats als vertrauenswürdigen Tokenaussteller in SharePoint verwendet hat. Dies ist häufig der Fall, wenn das Zertifikat als Aussteller des Actortokens für alle SharePoint-Add-Ins mit hoher Vertrauensstufe in der Farm verwendet wird. Ein Administrator kann auch festlegen, dass für jedes SharePoint-Add-In ein eigenes Zertifikat verwendet wird. In diesem Fall verwendet der Administrator verschiedene, zufällig generierte GUIDs für die Zertifikate. *Alle Buchstaben in der Aussteller-GUID müssen klein geschrieben werden.*</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p132">Same meaning as in the parent access token, but the issuer GUID is not the client ID of the web application. It is the GUID of the certificate. Although code in the application constructs the actor token, the certificate is considered the issuer of the actor token.Note that the issuer GUID in this example is an easy-to-remember GUID string that the farm administrator used when she registered the x.509 certificate as a trusted token issuer in SharePoint. This is common when the same certificate is used as the actor token issuer for all high-trust SharePoint Add-ins on the farm. An administrator can also choose to have distinct certificates for each SharePoint Add-in. In that case, she would use different randomly generated GUIDs for the certificates.  *All letters in the issuer GUID must be lower case.*</span></span> |<span data-ttu-id="7c7ee-259">11111111-1111-1111-1111-111111111111@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span><span class="sxs-lookup"><span data-stu-id="7c7ee-259">11111111-1111-1111-1111-111111111111@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span></span>|
| `nbf`|<span data-ttu-id="7c7ee-260">Dieselbe Bedeutung wie im übergeordneten Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-260">Same meaning as in the parent access token.</span></span>|<span data-ttu-id="7c7ee-261">Derselbe Wert wie im übergeordneten Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-261">Same value as the parent access token.</span></span>|
| `exp`|<span data-ttu-id="7c7ee-262">Dieselbe Bedeutung wie im übergeordneten Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-262">Same meaning as in the parent access token.</span></span>|<span data-ttu-id="7c7ee-263">Derselbe Wert wie im übergeordneten Zugriffstoken.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-263">Same value as the parent access token.</span></span>|
| `nameid`|<span data-ttu-id="7c7ee-p133">Ein eindeutiger Bezeichner für das SharePoint-Add-In, da es der "actor" im besonders vertrauenswürdigen System ist. Das Format ist  _Client_ID_@ _SharePoint_Bereich_</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p133">A unique identifier for the SharePoint Add-in, because it is the "actor" in the high-trust system. The format is  _client_ID_@ _SharePoint_realm_</span></span>|<span data-ttu-id="7c7ee-266">c3ab8885-458f-4864-8804-1608145e2ac4@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span><span class="sxs-lookup"><span data-stu-id="7c7ee-266">c3ab8885-458f-4864-8804-1608145e2ac4@52aa6841-b76b-4ed4-a3d7-a259fce1dfa2</span></span>|
| `trustedfordelegation`|<span data-ttu-id="7c7ee-p134">Ein boolescher Wert, der angibt, ob SharePoint dem SharePoint-Add-In beim Authentifizieren und Autorisieren des Benutzers vertrauen kann. Bei Systemen mit einer hohen Vertrauensstufe ist dies in der Regel so. Beziehen Sie diesen Anspruch nicht in einen reinen Add-In-Aufruf in Systemen mit hoher Vertrauensstufe ein.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p134">A Boolean value that specifies whether SharePoint should trust the SharePoint Add-in to authenticate and authorize the user. This is normally true in the high-trust system.Do not include this claim in an add-in-only call in the high-trust system.</span></span>|<span data-ttu-id="7c7ee-269">true</span><span class="sxs-lookup"><span data-stu-id="7c7ee-269">true</span></span>|

## <a name="encode-and-sign-tokens"></a><span data-ttu-id="7c7ee-270">Codieren und Signieren von Token</span><span class="sxs-lookup"><span data-stu-id="7c7ee-270">Encode and sign tokens</span></span>
<span data-ttu-id="7c7ee-271"><a name="EncodeTokens"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-271"></span></span>

 <span data-ttu-id="7c7ee-p135">**Nachdem Ihr Code alle Eigenschaften und Werte zu Header- und Hauptteil-JSON-Objekten hinzugefügt hat, muss er sie codieren, in ein JWT kombinieren und signieren.** Die einzelnen Schritte sind im Folgenden aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p135">**After your code has added all the properties and values to the header and body JSON objects, it has to encode them, combine them into a JWT, and sign it.** The following are the steps.</span></span>
 

 

1. <span data-ttu-id="7c7ee-274">Codieren Sie den Header mit der Base64-URL-Codierung.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-274">Encode the header with Base 64 URL encoding.</span></span>
    
 
2. <span data-ttu-id="7c7ee-275">Codieren Sie die Nutzlast mit der Base64-URL-Codierung.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-275">Encode the payload with Base 64 URL encoding.</span></span>
    
 
3. <span data-ttu-id="7c7ee-p136">Verknüpfen Sie den codierten Hauptteil nach dem codierten Header mit einem "."-Zeichen dazwischen. Dies ist das JWT.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p136">Concatenate the encoded body after the encoded header with a "." character in between them. This is the JWT.</span></span>
    
 
4. <span data-ttu-id="7c7ee-278">Erstellen Sie eine SHA256-Signatur mit dem JWT und dem privaten Schlüssel des Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-278">Create a SHA256 signature using the JWT and the private key of the certificate.</span></span>
    
 
5. <span data-ttu-id="7c7ee-279">Codieren Sie die Signatur mit der Base64-URL-Codierung.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-279">Encode the signature with Base 64 URL encoding.</span></span>
    
 
6. <span data-ttu-id="7c7ee-280">Fügen Sie die Signatur an das Ende von JWT an, und fügen Sie dazwischen einen Punkt („.“) ein.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-280">Append the signature to the end of the JWT, with a "." character between them.</span></span> 
    
 
<span data-ttu-id="7c7ee-p137">Für ein Actor-Token, das mit einem Nur-Add-In-Aufruf verwendet wird, dient das Actor-Token als Zugriffstoken. Es gibt kein äußeres Token. Für ein Zugriffstoken, das mit einem Benutzer-und-Add-In-Aufruf verwendet wird, werden die vorstehenden Schritte verwendet, um ein Actor-Token zu konstruieren, dass dann in den Hauptteil eines Zugriffstokens als Wert für die Eigenschaft **actortoken** eingefügt wird. Das vollständige Zugriffstoken wird dann mit den ersten drei Schritten oben codiert und konstruiert, aber nicht signiert, sodass die verbleibenden Schritte für das äußere Token nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p137">For an actor token that is used with an add-in-only call, the actor token serves as the access token. There is no outer token. For an access token that is used with a user+add-in call, the preceding steps are used to construct an actor token which is then inserted into the body of an access token as the value of the **actortoken** property. The full access token is then encoded and constructed with the first three steps above, but it is not signed, so the remaining steps are not used for the outer token.</span></span>
 

 

## <a name="troubleshoot-access-tokens"></a><span data-ttu-id="7c7ee-285">Zugriffstoken-Problembehandlung</span><span class="sxs-lookup"><span data-stu-id="7c7ee-285">Troubleshoot access tokens</span></span>
<span data-ttu-id="7c7ee-286"><a name="Trouble"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-286"></span></span>

<span data-ttu-id="7c7ee-p138">Das kostenlose  [Fiddler-Tool](http://www.telerik.com/fiddler) kann verwendet werden, um die HTTP-Anforderungen zu erfassen, die von der Remotekomponente Ihres Add-Ins SharePoint gesendet werden. Es gibt eine [kostenlose Erweiterung für das Tool](https://github.com/andrewconnell/SPOAuthFiddlerExt), die automatisch die Token in den Anforderungen dekodiert.</span><span class="sxs-lookup"><span data-stu-id="7c7ee-p138">The free  [Fiddler tool](http://www.telerik.com/fiddler) can be used to capture the HTTP Requests sent by the remote component of your add-in to SharePoint. There is a [free extension to the tool](https://github.com/andrewconnell/SPOAuthFiddlerExt) that automatically decodes the tokens in the requests.</span></span>
 

 

## <a name="additional-resources"></a><span data-ttu-id="7c7ee-289">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="7c7ee-289">Additional resources</span></span>
<span data-ttu-id="7c7ee-290"><a name="bk_addresources"> </a></span><span class="sxs-lookup"><span data-stu-id="7c7ee-290"></span></span>


-  [<span data-ttu-id="7c7ee-291">Erstellen von Add-Ins für SharePoint, die eine Autorisierung mit hoher Vertrauenswürdigkeit verwenden</span><span class="sxs-lookup"><span data-stu-id="7c7ee-291">Creating SharePoint Add-ins that use high-trust authorization</span></span>](creating-sharepoint-add-ins-that-use-high-trust-authorization.md)
    
 
- <span data-ttu-id="7c7ee-292">Steve Peschka  [Sicherheit in SharePoint-Add-Ins - Teil 7](http://blogs.technet.com/b/speschka/archive/2013/08/01/security-in-sharepoint-apps-part-7.aspx)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-292">Steve Peschka's  [Security in SharePoint Add-ins - Part 7](http://blogs.technet.com/b/speschka/archive/2013/08/01/security-in-sharepoint-apps-part-7.aspx)</span></span>
    
 
- <span data-ttu-id="7c7ee-293">Steve Peschka  [Sicherheit in SharePoint-Add-Ins - Teil 8](http://blogs.technet.com/b/speschka/archive/2013/08/01/security-in-sharepoint-apps-part-8.aspx)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-293">Steve Peschka's  [Security in SharePoint Add-ins - Part 8](http://blogs.technet.com/b/speschka/archive/2013/08/01/security-in-sharepoint-apps-part-8.aspx)</span></span>
    
 
- <span data-ttu-id="7c7ee-294">Steve Pescka  [Verwenden von SharePoint-Add-Ins mit SAML- und FBA-Websites in SharePoint 2013](http://blogs.technet.com/b/speschka/archive/2012/12/07/using-sharepoint-apps-with-saml-and-fba-sites-in-sharepoint-2013.aspx)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-294">Steve Pescka's  [Using SharePoint Add-ins with SAML and FBA Sites in SharePoint 2013](http://blogs.technet.com/b/speschka/archive/2012/12/07/using-sharepoint-apps-with-saml-and-fba-sites-in-sharepoint-2013.aspx)</span></span>
    
 
- <span data-ttu-id="7c7ee-295">Kirk Evan  [Besonders vertrauenswürdige SharePoint-Add-Ins auf Nicht-Microsoft-Plattformen](http://blogs.msdn.com/b/kaevans/archive/2014/07/14/high-trust-sharepoint-apps-on-non-microsoft-platforms.aspx)</span><span class="sxs-lookup"><span data-stu-id="7c7ee-295">Kirk Evan's  [High Trust SharePoint Add-ins on Non-Microsoft Platforms](http://blogs.msdn.com/b/kaevans/archive/2014/07/14/high-trust-sharepoint-apps-on-non-microsoft-platforms.aspx)</span></span>
    
 
-  [<span data-ttu-id="7c7ee-296">OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="7c7ee-296">OAuth 2.0</span></span>](http://oauth.net/2/)
    
 
